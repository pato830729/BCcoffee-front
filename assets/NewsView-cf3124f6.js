import{b,r as v,k as y,S as g,D as C,c as d,d as _,e as t,n as h,F as B,m as q,w as N,t as a,f as c,v as f,h as D,J as S,l as U,M as $}from"./index-8da19006.js";const M={class:"admin_title_search"},F={class:"admin_title_addDelete"},T=t("h1",null,"消息管理",-1),z=t("i",{class:"fa-solid fa-circle-plus"},null,-1),I=t("div",{class:"search_container"},[t("input",{type:"text",class:"search_input",placeholder:"以消息編號搜尋"}),t("button",{class:"admin_button button_search"},[t("i",{class:"fa-solid fa-magnifying-glass"}),h(" 搜尋 ")])],-1),A={class:"admin_table"},E=t("thead",null,[t("tr",null,[t("th",{class:"table_th_id"},"消息ID"),t("th",{class:"table_th_ell"},"標題"),t("th",{class:"table_th_ell"},"副標題"),t("th",{class:"table_th_short"},"分類"),t("th",{class:"table_th_short"},"狀態"),t("th",{class:"table_th_short"})])],-1),J={class:"table_td_id"},L={class:"table_td_ell"},O={class:"table_td_ell"},j={class:"table_th_short"},G={class:"table_th_short"},H=["onClick"],K=t("i",{class:"fa-solid fa-pen"},null,-1),P={class:"dialogBg"},Q=["onSubmit"],R={class:"dialogTitle"},W=t("i",{class:"fa-solid fa-xmark"},null,-1),X=[W],Y={class:"dialog_container"},Z={class:"text_container"},tt={class:"dialog_container_left"},et={class:"adminDialogBg_inputStyle"},st=t("label",{for:"dialog_title"},"標題：",-1),ot={class:"input_position"},it={key:0,class:"error_dialog"},lt={class:"adminDialogBg_inputStyle"},at=t("label",{for:"dialog_subtitle"},"副標題：",-1),nt={class:"input_position"},dt={key:0,class:"error_dialog"},_t={class:"adminDialogBg_selectStyle"},ct=t("label",{for:"dialog_select_category"},"消息分類：",-1),rt=t("option",{value:"新品上市",selected:""},"新品上市",-1),ut=t("option",{value:"活動消息"},"活動消息",-1),gt=t("option",{value:"媒體報導"},"媒體報導",-1),ht=t("option",{value:"店鋪資訊"},"店鋪資訊",-1),pt=[rt,ut,gt,ht],mt={class:"adminDialogBg_selectStyle"},bt=t("label",{for:"dialog_select_show"},"狀態：",-1),vt=t("option",{value:"true",selected:""},"上架",-1),yt=t("option",{value:"false"},"下架",-1),ft=[vt,yt],wt={class:"dialog_container_right"},kt={class:"adminDialogBg_textareaStyle"},Bt=t("label",{for:"dialog_description"},"內文：",-1),Dt={class:"adminDialogBg_image"},St=t("label",null,"消息圖片：",-1),Vt=t("button",{class:"admin_button button_save",type:"submit"},"儲存",-1),Nt={__name:"NewsView",setup(xt){const r={required(s){return!!s||"欄位必填"}},l=b([]),w=v(!1),e=b({_id:"",title:"",subtitle:"",description:"",image:void 0,show:!1,category:"",idx:-1}),n=b({name:"",description:""});function p(s){n[s]=!0}const u=()=>{const s=document.querySelector(".darkDialogBg"),o=document.querySelector(".dialogBg");s.style.display="none",o.style.display="none"},k=s=>{s===-1?(e._id="",e.title="",e.subtitle="",e.description="",e.image=void 0,e.show=!1,e.category="",v(!1),e.idx=-1,e.date=new Date().toISOString()):(e._id=l[s]._id,e.title=l[s].title,e.subtitle=l[s].subtitle,e.description=l[s].description,e.image=l[s].image,e.show=l[s].show,e.category=l[s].category,v(!1),e.idx=s);for(const i in n)n[i]=!1;const o=document.querySelector(".darkDialogBg"),m=document.querySelector(".dialogBg");o.style.display="block",m.style.display="block"},V=async()=>{if(!w.value)return;const s=new FormData;s.append("title",e.title),s.append("subtitle",e.subtitle),s.append("description",e.description),typeof e.image!="string"&&s.append("image",e.image),s.append("show",e.show),s.append("category",e.category),s.append("date",e.date);try{if(e._id.length===0){const{data:o}=await y.post("/news",s);l.push(o.result),g.fire({icon:"success",title:"成功",text:"新增成功"})}else{const{data:o}=await y.patch("/news/"+e._id,s);l[e.idx]=o.result,g.fire({icon:"success",title:"成功",text:"編輯成功"})}u()}catch(o){g.fire({icon:"error",title:"失敗",text:o?.response?.data?.message||"發生錯誤"})}};return(async()=>{try{const{data:s}=await y.get("/news/all");l.push(...s.result)}catch(s){g.fire({icon:"error",title:"失敗",text:s?.response?.data?.message||"發生錯誤"})}})(),(s,o)=>{const m=C("v-image-input");return d(),_(B,null,[t("div",M,[t("div",F,[T,t("button",{class:"admin_button button_add",onClick:o[0]||(o[0]=i=>k(-1))},[z,h(" 新增 ")])]),I]),t("div",A,[t("table",null,[E,t("tbody",null,[(d(!0),_(B,null,q(l,(i,x)=>(d(),_("tr",null,[t("td",J,a(i._id),1),t("td",L,a(i.title),1),t("td",O,a(i.subtitle),1),t("td",j,a(i.category),1),t("td",{class:"table_th_short",style:$(i.show?"color:#52b96c;":"color:#e43939;")},a(i.show?"上架":"下架"),5),t("td",G,[t("button",{class:"admin_button button_controll",onClick:Ct=>k(x)},[K,h("修改")],8,H)])]))),256))])])]),t("div",P,[t("form",{ref_key:"valid",ref:w,onSubmit:N(V,["prevent"])},[t("div",R,[h(a(e._id.length>0?"編輯消息":"新增消息")+" ",1),t("div",{class:"dialogClose",onClick:u},X)]),t("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[st,t("div",ot,[c(t("input",{type:"text",id:"dialog_title","onUpdate:modelValue":o[1]||(o[1]=i=>e.title=i),onBlur:o[2]||(o[2]=i=>p("title"))},null,544),[[f,e.title]]),n.title&&r.required(e.title)!==!0?(d(),_("p",it,a(r.required(e.title)),1)):D("",!0)])]),t("div",lt,[at,t("div",nt,[c(t("input",{type:"text",id:"dialog_subtitle","onUpdate:modelValue":o[3]||(o[3]=i=>e.subtitle=i),onBlur:o[4]||(o[4]=i=>p("subtitle"))},null,544),[[f,e.subtitle]]),n.subtitle&&r.required(e.subtitle)!==!0?(d(),_("p",dt,a(r.required(e.subtitle)),1)):D("",!0)])]),t("div",_t,[ct,c(t("select",{id:"dialog_select_category","onUpdate:modelValue":o[5]||(o[5]=i=>e.category=i)},pt,512),[[S,e.category]])]),t("div",mt,[bt,c(t("select",{id:"dialog_select_show","onUpdate:modelValue":o[6]||(o[6]=i=>e.show=i)},ft,512),[[S,e.show]])])]),t("div",wt,[t("div",kt,[Bt,c(t("textarea",{id:"dialog_description",rows:"10","onUpdate:modelValue":o[7]||(o[7]=i=>e.description=i),onBlur:o[8]||(o[8]=i=>p("description"))},null,544),[[f,e.description]])]),t("div",Dt,[St,U(m,{modelValue:e.image,"onUpdate:modelValue":o[9]||(o[9]=i=>e.image=i),"max-file-size":1,removable:""},null,8,["modelValue"])])])]),t("div",{class:"dialog_btn_container"},[t("button",{class:"admin_button button_close",onClick:u},"取消"),Vt])])],40,Q)]),t("div",{class:"darkDialogBg",onClick:u})],64)}}};export{Nt as default};
